{
  "mode": "train",

  "experiment": {
    "name": "cytonucs_stardist_hela_2d",
    "use_comet": false,
    "comet_api_key": "Yb0Ffy5WaM3qRxJ3qZAjvcboV",
    "comet_project": "cytonucs",
    "comet_workspace": "podtyazhki1337"
  },

  "data": {
    "dataset_dir": "/NAS/mmaiurov/Datasets/Cutonucs/preprocessed/",
    "validation_images": ["B02_01.png"],
    "skip_images": [],
    "pool_size": null,
    "repool_freq": 10
  },

  "preprocessing": {
    "run_preprocessing": false,
    "raw_images_dir": "/NAS/mmaiurov/Datasets/Cutonucs/images",
    "raw_nucleus_masks_dir": "/NAS/mmaiurov/Datasets/Cutonucs/nuc_masks/filled",
    "raw_cytoplasm_masks_dir": "/NAS/mmaiurov/Datasets/Cutonucs/cyto_masks/filled",
    "output_dir": "/NAS/mmaiurov/Datasets/Cutonucs/preprocessed/",
    "test_split": 0.25,
    "val_split": null,
    "compute_assignments": true,
    "seed": 42
  },

  "model": {
    "ndim": 2,
    "n_rays": 128,
    "anisotropy": [1, 1],
    "nucleus_grid": [1, 1],
    "cytoplasm_grid": [1, 1],
    "backbone": "unet",
    "shared_encoder": true,
    "n_channel_in": 3,
    "use_gpu": true
  },

  "training": {
    "train_patch_size": [512, 512],
    "train_batch_size": 2,
    "train_epochs": 400,
    "steps_per_epoch": 100,
    "initial_learning_rate": 1e-3,
    "lr_decay_steps": 500,
    "lr_decay_rate": 0.95,
    "lr_staircase": true,
    "gradient_clip_norm": 1.0,
    "resume_from_checkpoint": null
  },
  "inference": {
    "checkpoint_path": "/storage02/miroslavm/Multi-Nuclear-Stardist-2D-3D/models/cytonucs_stardist_hela_2d/weights_best.weights.h5",
    "prob_thresh": 0.15,
    "nms_thresh": 0.3,
    "prob_thresh_nucleus": 0.3,
    "prob_thresh_cytoplasm": 0.4
  },

  "loss_weights": {
    "lambda_prob_nucleus": 1.0,
    "lambda_dist_nucleus": 1.0,
    "lambda_prob_cytoplasm": 0.5,
    "lambda_dist_cytoplasm": 1.5,
    "lambda_containment": 0.0,
    "lambda_wbr": 0.0,
    "lambda_consistency": 0.0,
    "enable_consistency": false,
    "lambda_fragmentation": 0.05,
    "lambda_background_penalty": 0.1
  },
  "loss_params": {
    "containment_margin": 2.0,
    "max_assignment_distance": 100.0,
    "wbr_sigma": 2.0,
    "wbr_warmup_epochs": 5
  },

  "augmentation": {
    "enable": true,
    "flip_prob": 0.5,
    "rotation_yx": true,
    "intensity_range": [0.6, 2.0],
    "intensity_offset": [-0.2, 0.2],
    "gamma_range": [0.9, 1.1],
    "noise_sigma": 0.01,
    "zoom_range": null,
    "blur_sigma_range": null
  },

  "evaluation": {
    "eval_dice_every": 1,
    "optimize_thresholds": true,
    "prob_thresh_range": [0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5],
    "nms_thresh_range": [0.2, 0.25, 0.3, 0.35, 0.4, 0.45, 0.5],
    "compute_jtpr": true,
    "save_predictions": true
  },

  "output": {
    "basedir": "models",
    "save_best_dice": true,
    "save_every_n_epochs": 10,
    "save_history": true
  }
}
